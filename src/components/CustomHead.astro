---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Head.astro';

const isHomepage = Astro.url.pathname === '/' || Astro.url.pathname === '/index.html';
---

<Default {...Astro.props}><slot /></Default>

<style is:global>
  @reference "tailwindcss";
  /* 优化 SVG 图标：仅针对特定容器，避免全局冲突 */
  .site-title svg,
  .social-icons svg {
    --sl-icon-size: 1.2rem !important;
    @apply text-[var(--sl-icon-size)] w-[var(--sl-icon-size)] h-[var(--sl-icon-size)];
  }

  /* Header 优化 - 极致毛玻璃效果与 Apple 审美 */
  header {
    @apply px-4 backdrop-blur-[24px] backdrop-saturate-[200%] transition-all duration-[400ms] ease-[cubic-bezier(0.4,0,0.2,1)] shadow-[0_1px_2px_rgba(0,0,0,0.02),0_4px_12px_rgba(0,0,0,0.03),inset_0_1px_1px_rgba(255,255,255,0.4)] z-[100];
  }

  /* 修复移动端侧边栏开关不显示及展示瑕疵问题 */
  @media (max-width: 50rem) {
    /* 确保按钮的父容器可见，但不要遮挡点击 */
    nav.sidebar {
      @apply block h-0 overflow-visible;
    }

    /* 搜索按钮在左，菜单按钮在右 */
    site-search,
    [aria-controls="starlight__sidebar"] {
      @apply flex visible opacity-100 w-8 h-8 justify-center items-center fixed top-[0.7rem] z-[1000] bg-white rounded-full border-0 shadow-[0_8px_4px_hsla(0,0%,0%,0.01),0_5px_2px_hsla(0,0%,0%,0.03),0_3px_2px_hsla(0,0%,0%,0.06),0_1px_1px_hsla(0,0%,0%,0.06)];
    }

    starlight-menu-button,
    .mobile-menu-toggle,
    [aria-controls="starlight__sidebar"] {
      @apply right-4;
    }

    site-search {
      @apply right-[4.5rem];
    }

    starlight-menu-button button {
      @apply flex w-full h-full p-0 border-0 bg-transparent cursor-pointer justify-center items-center text-[#1d1d1f];
    }

    site-search svg,
    starlight-menu-button svg {
      @apply block w-[1.4rem] h-[1.4rem] text-[#1d1d1f] fill-current;
    }

    /* 精确控制切换图标：根据状态显示或隐藏 */
    starlight-menu-button button[aria-expanded="false"] .close-menu,
    starlight-menu-button button[aria-expanded="true"] .open-menu {
      @apply hidden;
    }

    /* 移动端隐藏可能冲突的元素 */
    .social-icons,
    .tagline {
      @apply hidden;
    }
  }

  .tagline {
    @apply text-[1.25rem] font-semibold tracking-[-0.01em] bg-[linear-gradient(135deg,#0066cc_0%,#c621e5_100%)] bg-clip-text text-transparent;
  }

  .site-title {
    @apply gap-3 font-bold tracking-[-0.03em];
    img {
      @apply w-9 h-9 rounded-[22%] shadow-[0_2px_8px_rgba(0,0,0,0.1)];
    }
  }

  .social-icons a {
    @apply p-2 rounded-lg transition-colors duration-200;
  }

  .social-icons a:hover {
    @apply bg-[#e5e5e5];
  }

  html[data-theme='dark'] .social-icons a:hover {
    @apply bg-[rgba(255,255,255,0.08)];
  }
</style>

{isHomepage && (
  <>
    <style is:global>
      @media (max-width: 50rem) {
        .mobile-theme-toggle {
          display: flex;
          visibility: visible;
          opacity: 1;
          width: 2rem;
          height: 2rem;
          justify-content: center;
          align-items: center;
          position: fixed;
          top: 0.7rem;
          right: 1rem;
          z-index: 1000;
          background-color: white;
          border-radius: 9999px;
          border: 0;
          box-shadow: 0 8px 4px hsla(0,0%,0%,0.01), 0 5px 2px hsla(0,0%,0%,0.03), 0 3px 2px hsla(0,0%,0%,0.06), 0 1px 1px hsla(0,0%,0%,0.06);
          cursor: pointer;
          padding: 0;
          color: #1d1d1f;
        }

        html[data-theme='dark'] .mobile-theme-toggle {
          background-color: #2c2c2e;
          color: white;
        }

        /* Dark mode button styles */
        html[data-theme='dark'] site-search,
        html[data-theme='dark'] starlight-menu-button,
        html[data-theme='dark'] .mobile-menu-toggle,
        html[data-theme='dark'] [aria-controls="starlight__sidebar"] {
          background-color: #2c2c2e;
        }

        html[data-theme='dark'] site-search button,
        html[data-theme='dark'] starlight-menu-button button,
        html[data-theme='dark'] site-search svg,
        html[data-theme='dark'] starlight-menu-button svg {
          color: white;
        }
      }
    </style>
    <script is:inline>
      (function() {
        const initThemeToggle = () => {
          if (window.innerWidth > 800) return; // 50rem = 800px
          if (document.querySelector('.mobile-theme-toggle')) return;
          
          const button = document.createElement('button');
          button.className = 'mobile-theme-toggle';
          button.setAttribute('aria-label', '切换主题');
          
          const sunIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:1.2rem;height:1.2rem;"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
          const moonIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:1.2rem;height:1.2rem;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
          
          const updateIcon = () => {
            const isDark = document.documentElement.dataset.theme === 'dark';
            button.innerHTML = isDark ? sunIcon : moonIcon;
          };
          
          updateIcon();
          
          button.addEventListener('click', () => {
            const currentTheme = document.documentElement.dataset.theme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.dataset.theme = newTheme;
            localStorage.setItem('starlight-theme', newTheme);
            updateIcon();
          });
          
          // 监听外部主题变化
          const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                updateIcon();
              }
            });
          });
          observer.observe(document.documentElement, { attributes: true });
          
          document.body.appendChild(button);
        };

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initThemeToggle);
        } else {
          initThemeToggle();
        }
      })();
    </script>
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "智析单词书 | GPT Wordbook",
      "alternateName": "AI 赋能的深度词汇学习平台",
      "url": "https://word.lovejade.cn/",
      "description": "智析单词书（GPT Wordbook）是 AI 驱动的深度英语词汇学习平台，精选 11000+ 核心词汇，利用 GPT 模型深度解析每个单词的词义、发音、例句、词根、词缀、同义词、反义词、文化内涵与使用场景，从理解本质出发构建长期记忆。",
      "inLanguage": "zh-CN",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://word.lovejade.cn/?search={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    })} />
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "智析单词书",
      "url": "https://word.lovejade.cn/",
      "logo": "https://word.lovejade.cn/logo.png",
      "image": "https://word.lovejade.cn/mockup.png",
      "description": "智析单词书（GPT Wordbook）是 AI 驱动的深度英语词汇学习平台，精选 11000+ 核心词汇，利用 GPT 模型深度解析每个单词的词义、发音、例句、词根、词缀、同义词、反义词、文化内涵与使用场景，从理解本质出发构建长期记忆。",
      "sameAs": [
        "https://mastodon.social/@nicejade",
        "https://t.me/nicejade",
        "https://www.youtube.com/@MarshalXuan",
        "https://www.facebook.com/nice.jade.yang",
        "https://x.com/MarshalXuan",
        "https://github.com/nicejade"
      ]
    })} />
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "首页",
          "item": "https://word.lovejade.cn/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "关于",
          "item": "https://word.lovejade.cn/about"
        }
      ]
    })} />
  </>
)}

