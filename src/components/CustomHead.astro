---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Head.astro';

const isHomepage = Astro.url.pathname === '/' || Astro.url.pathname === '/index.html';
---

<Default {...Astro.props}><slot /></Default>

<style is:global>
  /* 优化 SVG 图标：仅针对特定容器，避免全局冲突 */
  .site-title svg,
  .social-icons svg {
    --sl-icon-size: 1.2rem !important;
    font-size: var(--sl-icon-size) !important;
    width: var(--sl-icon-size) !important;
    height: var(--sl-icon-size) !important;
  }

  /* Header 优化 - 极致毛玻璃效果与 Apple 审美 */
  header {
    padding: 0 1rem !important;
    backdrop-filter: blur(24px) saturate(200%);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 1px 2px rgba(0, 0, 0, 0.02),
      0 4px 12px rgba(0, 0, 0, 0.03),
      inset 0 1px 1px rgba(255, 255, 255, 0.4);
    z-index: 100;
  }

  /* 修复移动端侧边栏开关不显示及展示瑕疵问题 */
  @media (max-width: 50rem) {
    /* 确保按钮的父容器可见，但不要遮挡点击 */
    nav.sidebar {
      display: block !important;
      height: 0;
      overflow: visible;
    }

    /* 搜索按钮在左，菜单按钮在右 */
    site-search,
    [aria-controls="starlight__sidebar"] {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 2rem !important;
      height: 2rem !important;
      justify-content: center !important;
      align-items: center !important;
      position: fixed !important;
      top: 0.7rem !important;
      z-index: 1000 !important;
      background: #ffffff !important;
      border-radius: 50% !important;
      border: none !important;
      box-shadow: 0px 8px 4px hsla(0, 0%, 0%, .01), 0px 5px 2px hsla(0, 0%, 0%, .03), 0px 3px 2px hsla(0, 0%, 0%, .06), 0px 1px 1px hsla(0, 0%, 0%, .06);
    }

    starlight-menu-button,
    .mobile-menu-toggle,
    [aria-controls="starlight__sidebar"] {
      right: 1rem !important; 
    }

    site-search {
      right: 4.5rem !important; 
    }

    site-search button,
    starlight-menu-button button {
      display: flex !important;
      width: 100% !important;
      height: 100% !important;
      padding: 0 !important;
      border: none !important;
      background: transparent !important;
      cursor: pointer !important;
      justify-content: center !important;
      align-items: center !important;
      color: #1d1d1f !important;
    }

    site-search svg,
    starlight-menu-button svg {
      display: block;
      width: 1.4rem !important;
      height: 1.4rem !important;
      color: #1d1d1f !important;
      fill: currentColor !important;
    }

    /* 精确控制切换图标：根据状态显示或隐藏 */
    starlight-menu-button button[aria-expanded="false"] .close-menu,
    starlight-menu-button button[aria-expanded="true"] .open-menu {
      display: none !important;
    }

    /* 移动端隐藏可能冲突的元素 */
    .social-icons,
    .tagline {
      display: none !important;
    }
  }

  html[data-theme='dark'] .header {
    background: rgba(28, 28, 30, 0.75) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    box-shadow: 
      0 1px 2px rgba(0, 0, 0, 0.2),
      0 8px 24px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .tagline {
    font-size: 1.25rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    background: linear-gradient(135deg, #0066cc 0%, #c621e5 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .site-title {
    gap: 0.75rem;
    font-weight: 700 !important;
    letter-spacing: -0.03em !important;
    img {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 22% !important; /* Apple Icon shape */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
  }

  .social-icons a {
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: background-color 0.2s ease;
  }

  .social-icons a:hover {
    background-color: #e5e5e5;
  }

  html[data-theme='dark'] .social-icons a:hover {
    background-color: rgba(255, 255, 255, 0.08);
  }
</style>

{isHomepage && (
  <>
    <style is:global>
      @media (max-width: 50rem) {
        .mobile-theme-toggle {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
          width: 2rem !important;
          height: 2rem !important;
          justify-content: center !important;
          align-items: center !important;
          position: fixed !important;
          top: 0.7rem !important;
          right: 1rem !important;
          z-index: 1000 !important;
          background: #ffffff !important;
          border-radius: 50% !important;
          border: none !important;
          box-shadow: 0px 8px 4px hsla(0, 0%, 0%, .01), 0px 5px 2px hsla(0, 0%, 0%, .03), 0px 3px 2px hsla(0, 0%, 0%, .06), 0px 1px 1px hsla(0, 0%, 0%, .06);
          cursor: pointer !important;
          padding: 0 !important;
          color: #1d1d1f !important;
        }

        html[data-theme='dark'] .mobile-theme-toggle {
          background: #2c2c2e !important;
          color: #ffffff !important;
        }

        /* 优化暗色模式下的按钮视觉 */
        html[data-theme='dark'] site-search,
        html[data-theme='dark'] starlight-menu-button,
        html[data-theme='dark'] .mobile-menu-toggle,
        html[data-theme='dark'] [aria-controls="starlight__sidebar"] {
          background: #2c2c2e !important;
        }

        html[data-theme='dark'] site-search button,
        html[data-theme='dark'] starlight-menu-button button,
        html[data-theme='dark'] site-search svg,
        html[data-theme='dark'] starlight-menu-button svg {
          color: #ffffff !important;
        }
      }
    </style>
    <script is:inline>
      (function() {
        const initThemeToggle = () => {
          if (window.innerWidth > 800) return; // 50rem = 800px
          if (document.querySelector('.mobile-theme-toggle')) return;
          
          const button = document.createElement('button');
          button.className = 'mobile-theme-toggle';
          button.setAttribute('aria-label', '切换主题');
          
          const sunIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:1.2rem;height:1.2rem;"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
          const moonIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:1.2rem;height:1.2rem;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
          
          const updateIcon = () => {
            const isDark = document.documentElement.dataset.theme === 'dark';
            button.innerHTML = isDark ? sunIcon : moonIcon;
          };
          
          updateIcon();
          
          button.addEventListener('click', () => {
            const currentTheme = document.documentElement.dataset.theme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.dataset.theme = newTheme;
            localStorage.setItem('starlight-theme', newTheme);
            updateIcon();
          });
          
          // 监听外部主题变化
          const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                updateIcon();
              }
            });
          });
          observer.observe(document.documentElement, { attributes: true });
          
          document.body.appendChild(button);
        };

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initThemeToggle);
        } else {
          initThemeToggle();
        }
      })();
    </script>
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "智析单词书",
      "alternateName": "基于 GPT 生成的单词书",
      "url": "https://word.lovejade.cn/",
      "description": "基于 GPT 生成的深度解析，涵盖超过 8000+ 核心英语词汇。不仅提供精准的词义与例句，更深入挖掘词根词缀、文化背景、记忆技巧及趣味小故事。旨在通过 AI 帮助英语学习者构建逻辑化的词汇体系，让单词记忆不再是死记硬背。",
      "inLanguage": "zh-CN",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://word.lovejade.cn/?search={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    })} />
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "智析单词书",
      "url": "https://word.lovejade.cn/",
      "logo": "https://word.lovejade.cn/logo.png",
      "image": "https://word.lovejade.cn/mockup.png",
      "description": "基于 GPT 生成的深度解析，涵盖超过 8000+ 核心英语词汇。不仅提供精准的词义与例句，更深入挖掘词根词缀、文化背景、记忆技巧及趣味小故事。旨在通过 AI 帮助英语学习者构建逻辑化的词汇体系，让单词记忆不再是死记硬背。",
      "sameAs": [
        "https://mastodon.social/@nicejade",
        "https://t.me/nicejade",
        "https://www.youtube.com/@MarshalXuan",
        "https://www.facebook.com/nice.jade.yang",
        "https://x.com/MarshalXuan",
        "https://github.com/nicejade"
      ]
    })} />
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "首页",
          "item": "https://word.lovejade.cn/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "关于",
          "item": "https://word.lovejade.cn/about"
        }
      ]
    })} />
  </>
)}

